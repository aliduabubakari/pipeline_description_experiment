{
  "unique_key": "sivajik34/magento-airflow:src/example_dags/magento_customer_graphql.py",
  "repo": "sivajik34/magento-airflow",
  "repo_url": "https://github.com/sivajik34/magento-airflow",
  "stars": 3,
  "license": "MIT",
  "file_path": "src/example_dags/magento_customer_graphql.py",
  "detected_airflow_version": "2.x",
  "sampled_versions": [
    {
      "version": "latest",
      "commit": "0f1f8e07d8148183b02d3f00ebbfe10cce8b3c11",
      "code": "from __future__ import annotations\nfrom datetime import datetime, timedelta\nfrom airflow import DAG\nfrom airflow.decorators import task\nfrom apache_airflow_provider_magento.operators.graphql import MagentoGraphQLOperator\nfrom airflow.exceptions import AirflowException\nimport logging\n\ndefault_args = {\n    'owner': 'airflow',\n    'depends_on_past': False,\n    'email_on_failure': False,\n    'email_on_retry': False,\n    'retries': 1,\n    'retry_delay': timedelta(minutes=5),\n}\n\nwith DAG(\n    'magento_graphql_customer',\n    default_args=default_args,\n    description='A DAG to handle Magento GraphQL operations using TaskFlow API',\n    schedule_interval=None,\n    start_date=datetime(2024, 8, 22),\n    catchup=False,\n) as dag:\n\n    @task\n    def create_customer() -> dict:\n        try:\n            operator = MagentoGraphQLOperator(\n                task_id='create_customer',\n                query=\"\"\"\n                mutation {\n                  createCustomer(\n                    input: {\n                      firstname: \"John\"\n                      lastname: \"Doe\"\n                      email: \"john.doe@example.com\"\n                      password: \"Airflow@123\"\n                    }\n                  ) {\n                    customer {\n                      id\n                      firstname\n                      lastname\n                      email\n                    }\n                  }\n                }\n                \"\"\",\n                magento_conn_id='magento_default',\n            )\n            result = operator.execute(context={})\n            customer_email = result['data']['createCustomer']['customer']['email']\n            logging.info(f\"Customer email created: {customer_email}\")\n            return {'customer_email': customer_email}  # Return as a dictionary\n        except AirflowException as e:\n            logging.error(f\"Error in create_customer task: {e}\")\n            raise\n\n    @task\n    def generate_customer_token(customer_email: str) -> str:\n        logging.info(f\"Customer email received: {customer_email}\")\n        try:\n            operator = MagentoGraphQLOperator(\n                task_id='generate_customer_token',\n                query=f\"\"\"\n                mutation {{\n                  generateCustomerToken(\n                    email: \"{customer_email}\"\n                    password: \"Airflow@123\"\n                  ) {{\n                    token\n                  }}\n                }}\n                \"\"\",\n                magento_conn_id='magento_default',\n            )\n            result = operator.execute(context={})\n            if 'errors' in result:\n                raise AirflowException(f\"GraphQL errors: {result['errors']}\")\n            customer_token = result['data']['generateCustomerToken']['token']\n            logging.info(f\"Customer token generated: {customer_token}\")\n            return customer_token\n        except AirflowException as e:\n            logging.error(f\"Error in generate_customer_token task: {e}\")\n            raise\n\n    @task\n    def get_customer_info(customer_token: str) -> dict:\n        logging.info(f\"Customer token received: {customer_token}\")\n        try:\n            operator = MagentoGraphQLOperator(\n                task_id='get_customer_info',\n                query=\"\"\"\n                query {\n                  customer {\n                    firstname\n                    lastname\n                    suffix\n                    email\n                    addresses {\n                      firstname\n                      lastname\n                      street\n                      city\n                      region {\n                        region_code\n                        region\n                      }\n                      postcode\n                      country_code\n                      telephone\n                    }\n                  }\n                }\n                \"\"\",\n                magento_conn_id='magento_default',\n                headers={\n                    'Authorization': f'Bearer {customer_token}'\n                }\n            )\n            result = operator.execute(context={})\n            if 'errors' in result:\n                raise AirflowException(f\"GraphQL errors: {result['errors']}\")\n            return result\n        except AirflowException as e:\n            logging.error(f\"Error in get_customer_info task: {e}\")\n            raise\n\n    # Define task dependencies\n    customer_creation_result = create_customer()\n    customer_email = customer_creation_result['customer_email']  # Extract email from the dictionary\n    customer_token = generate_customer_token(customer_email)\n    get_customer_info(customer_token)\n\n"
    }
  ],
  "sampled_time": "2025-08-22T20:40:48.114262Z",
  "analysis": {
    "is_production_dag": true,
    "is_airflow_2": true,
    "processing_type": "batch",
    "topology_pattern": "linear",
    "description": "Creates a Magento customer, generates authentication token, and retrieves customer information using GraphQL operations",
    "complexity_score": 3
  }
}